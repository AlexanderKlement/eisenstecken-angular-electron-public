<app-toolbar [title]="title"></app-toolbar>
<div class="window-container">
  <div fxLayout="column" fxLayoutAlign="space-around center">
    <h3>{{title}}</h3>
    <h3>{{jobName$ | async}}</h3>
  </div>
  <form [formGroup]="recalculationGroup" (submit)="onSubmit()">
    <div fxLayout="column" fxLayoutAlign="space-around center">
      <mat-form-field appearance="fill">
        <mat-label>Materialkostenaufschlag [%]</mat-label>
        <input type=number class="form-control" formControlName="material_charge_percent" matInput>
      </mat-form-field>
    </div>
    <div fxLayout="column" fxLayoutAlign="space-around center" formArrayName="wood_lists">
      <h3>Preise Holzlisten</h3>
      @for (wood_list of getWoodLists().controls; track wood_list; let i = $index) {
        <div [formGroupName]="i" fxLayout="row"
          fxLayoutAlign="space-around center">
          <mat-form-field appearance="fill">
            <mat-label>Bezeichnung</mat-label>
            <input class="form-control" formControlName="name" matInput>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Preis [€]</mat-label>
            <input type=number class="form-control" formControlName="price" matInput>
          </mat-form-field>
          <div class="position-delete">
            <app-circle-icon-button icon="delete" (click)="removeWoodListAt(i)" />
          </div>
        </div>
      }
      <app-circle-icon-button (click)="addWoodList()" icon="add" />
    </div>
    <div fxLayout="column" fxLayoutAlign="space-around center" formArrayName="paints">
      <h3>Oberflächen</h3>
      <div fxLayout="row" fxLayoutAlign="space-between start">
        <div fxLayout="column" fxLayoutAlign="space-around center">
          <h4>Benutzt</h4>
          @for (paint of getPaints().controls; track paint; let i = $index) {
            <div [formGroupName]="i" fxLayout="row"
              fxLayoutAlign="space-around center">
              <mat-form-field appearance="fill">
                <mat-label>Bezeichnung</mat-label>
                <input class="form-control" formControlName="name" matInput>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Menge</mat-label>
                <input type=number class="form-control" formControlName="amount" matInput>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Einheit</mat-label>
                <mat-select formControlName="unit_id">
                  @for (unit of units$ | async; track unit) {
                    <mat-option [value]="unit.id">
                      {{unit.name.translation}}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Preis [€]</mat-label>
                <input type=number class="form-control" formControlName="price" matInput>
              </mat-form-field>
              <div class="position-delete">
                <app-circle-icon-button (click)="removePaintAt(i)" icon="delete" />
              </div>
            </div>
          }
          <app-circle-icon-button (click)="addPaint()" icon="add" />
        </div>
        <div fxLayout="column" fxLayoutAlign="space-around center" class="separator-left">
          <h4>Vorlagen</h4>
          <mat-action-list>
            @for (templatePaint of (templatePaints$ | async); track templatePaint) {
              <button mat-list-item
                (click)="templatePaintClicked(templatePaint)">
                {{templatePaint.name}}
              </button>
            }
          </mat-action-list>
        </div>
      </div>
    </div>
    <div fxLayout="column" fxLayoutAlign="space-around center" formArrayName="expenses">
      <h3>Zusatzkosten</h3>
      @for (expense of getExpenses().controls; track expense; let i = $index) {
        <div [formGroupName]="i" fxLayout="row" class="wide"
          fxLayoutAlign="center center">
          <mat-form-field appearance="fill" class="wide">
            <mat-label>Bezeichnung</mat-label>
            <input class="form-control" formControlName="name" matInput>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Preis [€]</mat-label>
            <input type=number class="form-control" formControlName="amount" matInput>
          </mat-form-field>
          <div class="position-delete">
            <app-circle-icon-button (click)="removeExpenseAt(i)" icon="delete" />
          </div>
        </div>
      }
      <app-circle-icon-button (click)="addExpense()" icon="add" />
    </div>
    <app-table-builder [dataSource]="orderDataSource" title="Bestellungen"></app-table-builder>
    <app-table-builder [dataSource]="workloadDataSource" title="Arbeitszeit"></app-table-builder>
    <div fxLayout="column" fxLayoutAlign="space-around center">
      <h3>Fahrten</h3>
      <div fxLayout="row" fxLayoutAlign="center center" class="wide">
        <mat-form-field appearance="fill" class="wide">
          <mat-label>Kilometer</mat-label>
          <input class="form-control" formControlName="km" matInput>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Kosten / Kilometer</mat-label>
          <input class="form-control" formControlName="cost" matInput>
        </mat-form-field>
      </div>
    </div>
    <div fxLayout="column" fxLayoutAlign="space-around center">
      <button [disabled]="submitted" mat-raised-button type="submit">Speichern</button>
    </div>
  </form>
</div>
